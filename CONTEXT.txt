# UnderTech - PadrÃµes do Projeto

## ğŸ“š Stack TecnolÃ³gica

### EVITAR EMOJI NO SCRIPT ###

### Backend
- **Runtime**: Node.js v18+
- **Framework**: Express.js
- **Banco de Dados**: SQLite (dev) â†’ PostgreSQL (prod)
- **AutenticaÃ§Ã£o**: JWT + bcryptjs
- **ValidaÃ§Ã£o**: express-validator

### Frontend
- **Markup**: HTML5 SemÃ¢ntico
- **EstilizaÃ§Ã£o**: CSS3 (Custom Properties, Grid, Flexbox)
- **Script**: JavaScript ES6+ (Vanilla, sem frameworks)
- **Fontes**: Google Fonts (Montserrat, Inter)

### DevOps
- **Controle de VersÃ£o**: Git
- **Gerenciador de Pacotes**: npm
- **Ambiente**: dotenv

---

## ğŸ—ï¸ Arquitetura

### Camadas de Responsabilidade

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         FRONTEND (HTML/CSS/JS)      â”‚
â”‚  - Apenas apresentaÃ§Ã£o e eventos    â”‚
â”‚  - Sem lÃ³gica de negÃ³cio            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ HTTP/REST
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ROUTES (Express)            â”‚
â”‚  - DefiniÃ§Ã£o de endpoints           â”‚
â”‚  - AplicaÃ§Ã£o de middlewares         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CONTROLLERS                 â”‚
â”‚  - ValidaÃ§Ã£o de entrada             â”‚
â”‚  - Chamada aos Services             â”‚
â”‚  - FormataÃ§Ã£o de resposta           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         SERVICES                    â”‚
â”‚  - Regras de negÃ³cio                â”‚
â”‚  - CÃ¡lculos e transformaÃ§Ãµes        â”‚
â”‚  - Chamada aos Repositories         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         REPOSITORIES                â”‚
â”‚  - Acesso direto ao banco           â”‚
â”‚  - Queries SQL                      â”‚
â”‚  - Mapeamento objeto-relacional     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ PadrÃµes de CÃ³digo

### Nomenclatura

| Tipo | PadrÃ£o | Exemplo |
|------|--------|---------|
| VariÃ¡veis/FunÃ§Ãµes | camelCase | `getUserById`, `totalClientes` |
| Classes | PascalCase | `ClienteService`, `AuthMiddleware` |
| Constantes | UPPER_SNAKE_CASE | `MAX_RETRY_ATTEMPTS` |
| Arquivos | kebab-case | `cliente-service.js`, `auth-middleware.js` |
| Pastas | lowercase inglÃªs | `controllers`, `services`, `middlewares` |
| Rotas | kebab-case | `/api/clientes`, `/api/ordens-servico` |

### Idioma

- **CÃ³digo**: InglÃªs (funÃ§Ãµes, variÃ¡veis, classes)
- **DomÃ­nio**: PortuguÃªs (entidades, campos do negÃ³cio)
- **ComentÃ¡rios**: PortuguÃªs (documentaÃ§Ã£o)

```javascript
// âŒ Evitar
const getCliente = async (clienteId) => { ... }

// âœ… Preferir
const getClienteById = async (id) => { ... }
```

### OrganizaÃ§Ã£o de Imports

```javascript
// 1. DependÃªncias externas
const express = require('express');
const bcrypt = require('bcryptjs');

// 2. MÃ³dulos internos do projeto
const { ClienteService } = require('../services/clienteService');
const { authMiddleware } = require('../middlewares/authMiddleware');

// 3. ConfiguraÃ§Ãµes e utilitÃ¡rios
const { formatCPF } = require('../utils/formatters');
```

---

## ğŸ”’ Regras de NegÃ³cio

### SeparaÃ§Ã£o de Responsabilidades

1. **Controllers**: 
   - Recebem requisiÃ§Ã£o
   - Validam formato bÃ¡sico
   - Chamam Services
   - Retornam resposta HTTP

2. **Services**: 
   - ContÃªm toda lÃ³gica de negÃ³cio
   - Calculam situaÃ§Ã£o de clientes
   - Aplicam regras de validaÃ§Ã£o complexas
   - Orquestram chamadas a Repositories

3. **Repositories**:
   - Executam queries SQL
   - Mapeiam resultados
   - Tratam erros de banco

### Exemplo Correto

```javascript
// âŒ ERRADO - Controller acessando banco
const listarClientes = async (req, res) => {
  const clientes = await db.query('SELECT * FROM clientes');
  res.json(clientes);
};

// âœ… CORRETO - Usando camadas
// Controller
const listarClientes = async (req, res) => {
  const clientes = await ClienteService.listar(req.query);
  res.json({ success: true, data: clientes });
};

// Service
class ClienteService {
  static async listar(filters) {
    const clientes = await ClienteRepository.findAll(filters);
    return aplicarSituacaoEmClientes(clientes);
  }
}

// Repository
class ClienteRepository {
  static async findAll(filters) {
    return await db.query('SELECT * FROM clientes WHERE ...');
  }
}
```

---

## ğŸ¨ PadrÃµes Frontend

### Estrutura de Arquivos

```
frontend/
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â”œâ”€â”€ variables.css      # Tokens de design
â”‚   â”‚   â”œâ”€â”€ reset.css          # NormalizaÃ§Ã£o
â”‚   â”‚   â”œâ”€â”€ layout.css         # Estrutura global
â”‚   â”‚   â”œâ”€â”€ components.css     # Componentes reutilizÃ¡veis
â”‚   â”‚   â””â”€â”€ [page].css         # Estilos especÃ­ficos
â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â”œâ”€â”€ utils.js           # FunÃ§Ãµes auxiliares
â”‚   â”‚   â”œâ”€â”€ api.js             # Cliente HTTP
â”‚   â”‚   â”œâ”€â”€ auth.js            # AutenticaÃ§Ã£o
â”‚   â”‚   â””â”€â”€ [page].js          # LÃ³gica especÃ­fica
â”‚   â””â”€â”€ img/
â””â”€â”€ pages/
    â””â”€â”€ [page].html
```

### CSS

- Usar **Custom Properties** para tokens de design
- Evitar IDs para estilizaÃ§Ã£o (usar classes)
- Nomenclatura BEM quando apropriado
- Mobile-first responsivo

```css
/* âœ… Bom */
.card-cliente { }
.card-cliente__header { }
.card-cliente--destaque { }

/* âŒ Evitar */
#cliente1 { }
div.box { }
```

### JavaScript

- Vanilla JS puro (sem jQuery/frameworks)
- Classes para organizaÃ§Ã£o
- Async/await para assincronismo
- Event delegation quando possÃ­vel

```javascript
// âœ… Bom
class ClienteManager {
  async carregarClientes() {
    try {
      const data = await api.get('/clientes');
      this.renderizar(data);
    } catch (error) {
      utils.showToast(error.message, 'error');
    }
  }
}

// âŒ Evitar callbacks aninhados
api.get('/clientes', function(data) {
  renderizar(data, function(html) {
    inserir(html, function() { ... });
  });
});
```

---

## ğŸ” SeguranÃ§a

### ObrigatÃ³rio

- âœ… Hash de senhas com bcrypt (10+ rounds)
- âœ… Tokens JWT com expiraÃ§Ã£o
- âœ… ValidaÃ§Ã£o de entrada (express-validator)
- âœ… SanitizaÃ§Ã£o de dados
- âœ… HTTPS em produÃ§Ã£o
- âœ… VariÃ¡veis sensÃ­veis em `.env`

### Proibido

- âŒ Senhas em plain text
- âŒ SQL injection vulnerÃ¡vel
- âŒ Tokens sem expiraÃ§Ã£o
- âŒ Credenciais no cÃ³digo
- âŒ CORS aberto em produÃ§Ã£o

---

## ğŸ“ DocumentaÃ§Ã£o

### ComentÃ¡rios

```javascript
/**
 * Calcula a situaÃ§Ã£o do cliente baseado na Ãºltima compra
 * 
 * @param {Date} ultimaCompra - Data da Ãºltima compra
 * @returns {string} "ativo" | "em_risco" | "inativo"
 * 
 * Regras:
 * - ATIVO: atÃ© 90 dias
 * - EM RISCO: 90-180 dias
 * - INATIVO: 180+ dias
 */
const calcularSituacao = (ultimaCompra) => {
  // implementaÃ§Ã£o
};
```

### Commits

PadrÃ£o Conventional Commits:

```
feat: adiciona cadastro de clientes
fix: corrige cÃ¡lculo de situaÃ§Ã£o
refactor: extrai lÃ³gica para service
docs: atualiza README
style: formata cÃ³digo
test: adiciona testes de validaÃ§Ã£o
chore: atualiza dependÃªncias
```

---

## ğŸš€ Deployment

### Checklist PrÃ©-Deploy

- [ ] Migrar de SQLite para PostgreSQL
- [ ] Configurar variÃ¡veis de ambiente
- [ ] Gerar JWT_SECRET seguro
- [ ] Configurar CORS especÃ­fico
- [ ] Habilitar HTTPS
- [ ] Configurar rate limiting
- [ ] Revisar logs de erro
- [ ] Backup do banco configurado

---

## ğŸ“Š Versionamento

- **Semantic Versioning**: MAJOR.MINOR.PATCH
- **Branches**: 
  - `main` - produÃ§Ã£o
  - `develop` - desenvolvimento
  - `feature/nome` - funcionalidades
  - `hotfix/nome` - correÃ§Ãµes urgentes

---

## ğŸ”„ Processo de ModificaÃ§Ã£o

### Antes de Implementar

1. âœ… Verificar se segue os padrÃµes acima
2. âœ… Confirmar separaÃ§Ã£o de camadas
3. âœ… Validar nomenclatura
4. âœ… Documentar mudanÃ§as

### ComunicaÃ§Ã£o ObrigatÃ³ria

**Sempre informar sobre:**
- AdiÃ§Ã£o de novas dependÃªncias
- MudanÃ§as na estrutura de pastas
- AlteraÃ§Ãµes em regras de negÃ³cio
- ModificaÃ§Ãµes no banco de dados
- AtualizaÃ§Ãµes de seguranÃ§a

---

## ğŸ“š ReferÃªncias

- [Node.js Best Practices](https://github.com/goldbergyoni/nodebestpractices)
- [Clean Code JavaScript](https://github.com/ryanmcdermott/clean-code-javascript)
- [Express.js Guide](https://expressjs.com/en/guide/routing.html)
- [MDN Web Docs](https://developer.mozilla.org/)

---

**Ãšltima atualizaÃ§Ã£o**: Janeiro 2026
**VersÃ£o do Documento**: 2.0